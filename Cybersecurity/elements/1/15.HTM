<H1 data-immersive-translate-paragraph="1" data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822">Account takeover via misconfigured SSO [OIDC] implementation 
<P><SPAN class=headers>Title:</SPAN></B><SPAN class=RefText> &#36890;&#36807;&#37197;&#32622;&#38169;&#35823;&#30340; SSO [OIDC] &#23454;&#29616;&#30340;&#36134;&#25143;&#25509;&#31649;</SPAN></FONT></H1>
<DIV data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822">
<H2 data-immersive-translate-paragraph="1" data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><SPAN class=headers>Author:</SPAN></B><SPAN class=RefText> crypt0g30rgy</SPAN></FONT></H2>
<P data-immersive-translate-paragraph="1" data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><A href="https://blog.xboy.me/post/AccountTakeover"><SPAN class=headers>Link:</SPAN></B><SPAN class=RefText> https://blog.xboy.me/post/AccountTakeover</SPAN></FONT></A></P>
<P data-immersive-translate-paragraph="1" data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><A href="https://blog.xboy.me/"><SPAN class=headers>Source:</SPAN></B><SPAN class=RefText> https://blog.xboy.me/</SPAN></FONT></A></P>
<H2 data-immersive-translate-paragraph="1" data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822">How we got there 
<P>&#25105;&#20204;&#26159;&#22914;&#20309;&#21040;&#36798;&#37027;&#37324;&#30340;</H2>
<P data-immersive-translate-paragraph="1" data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822">A story about how an OIDC login provider without email confirmation allowed me takeover accounts on a different web app. 
<P>&#19968;&#20010;&#20851;&#20110;&#22914;&#20309;&#36890;&#36807;&#27809;&#26377;&#30005;&#23376;&#37038;&#20214;&#30830;&#35748;&#30340; OIDC &#30331;&#24405;&#25552;&#20379;&#32773;&#35753;&#25105;&#25509;&#31649;&#21478;&#19968;&#20010;&#32593;&#32476;&#24212;&#29992;&#31243;&#24207;&#36134;&#25143;&#30340;&#25925;&#20107;&#12290;</P>
<P data-immersive-translate-paragraph="1" data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822">This was on a particular friday evening after reading an interesting writeup about Oauth security issues that lead to account takeover, i decided to test the new knowledge on a target i had seen supported Oauth2 login. My target lets call it<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">xboy.me</FONT></CODE><SPAN>&nbsp;</SPAN>was intersting as it had a few applications in scope, lets call them<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">court-app.xboy.me</FONT></CODE><SPAN>&nbsp;</SPAN>and<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">tennis-app.xboy.me</FONT></CODE>. Now<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">court-app.xboy.me</FONT></CODE><SPAN>&nbsp;</SPAN>supported various Oauth2 methods like google, etc. However<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">tennis-app.xboy.me</FONT></CODE><SPAN>&nbsp;</SPAN>had only two login options (1) username/email and password via Cognito (2) Oauth2 OIDC [from<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">court-app.xboy.me</FONT></CODE>] via Cognito. 
<P>&#36825;&#26159;&#22312;&#19968;&#20010;&#29305;&#23450;&#30340;&#26143;&#26399;&#20116;&#26202;&#19978;&#65292;&#22312;&#38405;&#35835;&#20102;&#19968;&#31687;&#20851;&#20110; Oauth &#23433;&#20840;&#38382;&#39064;&#30340;&#26377;&#36259;&#25991;&#31456;&#21518;&#65292;&#36825;&#20123;&#38382;&#39064;&#23548;&#33268;&#20102;&#36134;&#25143;&#25509;&#31649;&#65292;&#25105;&#20915;&#23450;&#22312;&#19968;&#20010;&#25105;&#30475;&#21040;&#25903;&#25345; Oauth2 &#30331;&#24405;&#30340;&#30446;&#26631;&#19978;&#27979;&#35797;&#26032;&#30693;&#35782;&#12290;&#25105;&#30340;&#30446;&#26631;&#65292;&#31216;&#20043;&#20026;<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">xboy.me</FONT></CODE><SPAN>&nbsp;</SPAN>&#65292;&#24456;&#26377;&#36259;&#65292;&#22240;&#20026;&#23427;&#26377;&#20960;&#20010;&#22312;&#33539;&#22260;&#20869;&#30340;&#24212;&#29992;&#31243;&#24207;&#65292;&#31216;&#20043;&#20026;<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">court-app.xboy.me</FONT></CODE><SPAN>&nbsp;</SPAN>&#21644;<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">tennis-app.xboy.me</FONT></CODE><SPAN>&nbsp;</SPAN>&#12290;&#29616;&#22312;<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">court-app.xboy.me</FONT></CODE><SPAN>&nbsp;</SPAN>&#25903;&#25345;&#21508;&#31181; Oauth2 &#26041;&#27861;&#65292;&#22914;&#35895;&#27468;&#31561;&#12290;&#28982;&#32780;<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">tennis-app.xboy.me</FONT></CODE><SPAN>&nbsp;</SPAN>&#21482;&#26377;&#20004;&#20010;&#30331;&#24405;&#36873;&#39033;&#65288;1&#65289;&#36890;&#36807; Cognito &#30340;&#29992;&#25143;&#21517;/&#30005;&#23376;&#37038;&#20214;&#21644;&#23494;&#30721;&#65288;2&#65289;&#36890;&#36807; Cognito &#30340; Oauth2 OIDC [&#26469;&#33258;<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">court-app.xboy.me</FONT></CODE><SPAN>&nbsp;</SPAN>]&#12290;</P>
<BLOCKQUOTE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822">
<P data-immersive-translate-paragraph="1" data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822">OIDC =<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">OpenID Connect (OIDC) is an identity layer built on top of the OAuth 2.0 framework. It allows third-party applications to verify the identity of the end-user and to obtain basic user profile information. OIDC uses JSON web tokens (JWTs), which you can obtain using flows conforming to the OAuth 2.0 specifications.</FONT></CODE><SPAN>&nbsp;</SPAN>by<SPAN>&nbsp;</SPAN><A href="https://auth0.com/docs/authenticate/protocols/openid-connect-protocol#:~:text=OpenID%20Connect%20(OIDC)%20is%20an,to%20the%20OAuth%202.0%20specifications." data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822">https://auth0.com/docs/authenticate/protocols/openid-connect-protocol#:~:text=OpenID%20Connect%20(OIDC)%20is%20an,to%20the%20OAuth%202.0%20specifications.</A></P></BLOCKQUOTE>
<P data-immersive-translate-paragraph="1" data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822">The web application at<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">https://court-app.xboy.me/</FONT></CODE><SPAN>&nbsp;</SPAN>uses custom user authentication/registration which allows users to signup/register accounts and use them without email activation/confirmation, while<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">https://tennis-app.xboy.me</FONT></CODE><SPAN>&nbsp;</SPAN>uses AWS cognito, which ensures users confirm their emails before using the account. The web app<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">https://tennis-app.xboy.me</FONT></CODE><SPAN>&nbsp;</SPAN>also uses Oauth2 (OIDC) from<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">https://court-app.xboy.me/</FONT></CODE><SPAN>&nbsp;</SPAN>which as i said allows unverified users to use the web app. 
<P>&#20301;&#20110;<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">https://court-app.xboy.me/</FONT></CODE><SPAN>&nbsp;</SPAN>&#30340;&#32593;&#32476;&#24212;&#29992;&#31243;&#24207;&#20351;&#29992;&#33258;&#23450;&#20041;&#29992;&#25143;&#36523;&#20221;&#39564;&#35777;/&#27880;&#20876;&#65292;&#20801;&#35768;&#29992;&#25143;&#27880;&#20876;&#36134;&#25143;&#24182;&#22312;&#26080;&#38656;&#30005;&#23376;&#37038;&#20214;&#28608;&#27963;/&#30830;&#35748;&#30340;&#24773;&#20917;&#19979;&#20351;&#29992;&#23427;&#20204;&#65292;&#32780;<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">https://tennis-app.xboy.me</FONT></CODE><SPAN>&nbsp;</SPAN>&#20351;&#29992; AWS Cognito&#65292;&#30830;&#20445;&#29992;&#25143;&#22312;&#20351;&#29992;&#36134;&#25143;&#20043;&#21069;&#30830;&#35748;&#20182;&#20204;&#30340;&#30005;&#23376;&#37038;&#20214;&#12290;&#32593;&#32476;&#24212;&#29992;&#31243;&#24207;<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">https://tennis-app.xboy.me</FONT></CODE><SPAN>&nbsp;</SPAN>&#36824;&#20351;&#29992;&#26469;&#33258;<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">https://court-app.xboy.me/</FONT></CODE><SPAN>&nbsp;</SPAN>&#30340; Oauth2 (OIDC)&#65292;&#27491;&#22914;&#25105;&#25152;&#35828;&#65292;&#20801;&#35768;&#26410;&#39564;&#35777;&#30340;&#29992;&#25143;&#20351;&#29992;&#35813;&#32593;&#32476;&#24212;&#29992;&#31243;&#24207;&#12290;</P>
<H3 data-immersive-translate-paragraph="1" data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822">Heres how the<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">tennis-app.xboy.me</FONT></CODE><SPAN>&nbsp;</SPAN>OIDC flow goes 
<P>&#36825;&#26159;<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">tennis-app.xboy.me</FONT></CODE><SPAN>&nbsp;</SPAN>OIDC &#27969;&#31243;&#30340;&#36827;&#34892;&#26041;&#24335;</H3>
<BLOCKQUOTE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822">
<P data-immersive-translate-paragraph="1" data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822">user goes to<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">https://tennis-app.xboy.me</FONT></CODE><SPAN>&nbsp;</SPAN>=&gt; clicks login via oauth =&gt;<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">https://tennis-app.xboy.me</FONT></CODE><SPAN>&nbsp;</SPAN>oauth request to<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">https://tennis-app.auth.us-west-1.amazoncognito.com/oauth2/authorize</FONT></CODE><SPAN>&nbsp;</SPAN>=&gt; gets redirected to<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">https://court-app.xboy.me/oauth2/authenticate</FONT></CODE><SPAN>&nbsp;</SPAN>=&gt; gets redirected to<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">https://court-app.xboy.me/api/oauth2/authorize?</FONT></CODE><SPAN>&nbsp;</SPAN>=&gt;<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">https://tennis-app.xboy.me/oauth2?</FONT></CODE><SPAN>&nbsp;</SPAN>=&gt; gets redirected to<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">https://court-app.xboy.me/oauth2/idpresponse?</FONT></CODE><SPAN>&nbsp;</SPAN>=&gt; gets redirected to =&gt;<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">https://tennis-app.auth.us-west-1.amazoncognito.com/oauth2/idpresponse?</FONT></CODE><SPAN>&nbsp;</SPAN>=&gt; gets redirected to<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">https://tennis-app.xboy.me/oauth/success?</FONT></CODE><SPAN>&nbsp;</SPAN>=&gt;<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">https://tennis-app.auth.us-west-1.amazoncognito.com/oauth2/token</FONT></CODE><SPAN>&nbsp;</SPAN>[post request to get access token]</P></BLOCKQUOTE>
<H3 data-immersive-translate-paragraph="1" data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822">What goes on&nbsp;&nbsp;&#21457;&#29983;&#20102;&#20160;&#20040;</H3>
<P data-immersive-translate-paragraph="1" data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822">When a user clicks on login via<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">court-app</FONT></CODE><SPAN>&nbsp;</SPAN>the flow fetches the required token and info from<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">court-app</FONT></CODE><SPAN>&nbsp;</SPAN>and everything is well and expected. However instead of logging in the user directly an account is created with the<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">court-app</FONT></CODE><SPAN>&nbsp;</SPAN>details and this account is not the same as the one we need to takeover. However a weird behaviour happens. 
<P>&#24403;&#29992;&#25143;&#36890;&#36807;<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">court-app</FONT></CODE><SPAN>&nbsp;</SPAN>&#28857;&#20987;&#30331;&#24405;&#26102;&#65292;&#27969;&#31243;&#20174;<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">court-app</FONT></CODE><SPAN>&nbsp;</SPAN>&#33719;&#21462;&#25152;&#38656;&#30340;&#20196;&#29260;&#21644;&#20449;&#24687;&#65292;&#19968;&#20999;&#27491;&#24120;&#12290;&#28982;&#32780;&#65292;&#29992;&#25143;&#24182;&#27809;&#26377;&#30452;&#25509;&#30331;&#24405;&#65292;&#32780;&#26159;&#20351;&#29992;<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">court-app</FONT></CODE><SPAN>&nbsp;</SPAN>&#30340;&#35814;&#32454;&#20449;&#24687;&#21019;&#24314;&#20102;&#19968;&#20010;&#36134;&#25143;&#65292;&#32780;&#36825;&#20010;&#36134;&#25143;&#19982;&#25105;&#20204;&#38656;&#35201;&#25509;&#31649;&#30340;&#36134;&#25143;&#24182;&#19981;&#30456;&#21516;&#12290;&#28982;&#32780;&#65292;&#20986;&#29616;&#20102;&#19968;&#31181;&#22855;&#24618;&#30340;&#34892;&#20026;&#12290;</P>
<H3 data-immersive-translate-paragraph="1" data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822">The weird behaviour&nbsp;&nbsp;&#22855;&#24618;&#30340;&#34892;&#20026;</H3>
<P data-immersive-translate-paragraph="1" data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822">Ater a successful account creation with<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">court-app</FONT></CODE><SPAN>&nbsp;</SPAN>details, the<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">https://tennis-app.xboy.me</FONT></CODE><SPAN>&nbsp;</SPAN>web app sends a post request<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">https://tennis-app.xboy.me/api/token/refresh</FONT></CODE><SPAN>&nbsp;</SPAN>with the idToken param containing the jwt created after the account creation. 
<P>&#22312;&#25104;&#21151;&#21019;&#24314;&#24102;&#26377;<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">court-app</FONT></CODE><SPAN>&nbsp;</SPAN>&#35814;&#32454;&#20449;&#24687;&#30340;&#36134;&#25143;&#21518;&#65292;<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">https://tennis-app.xboy.me</FONT></CODE><SPAN>&nbsp;</SPAN>&#32593;&#32476;&#24212;&#29992;&#31243;&#24207;&#21457;&#36865;&#19968;&#20010;&#21253;&#21547; idToken &#21442;&#25968;&#30340; POST &#35831;&#27714;<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">https://tennis-app.xboy.me/api/token/refresh</FONT></CODE><SPAN>&nbsp;</SPAN>&#65292;&#35813;&#21442;&#25968;&#21253;&#21547;&#22312;&#36134;&#25143;&#21019;&#24314;&#21518;&#29983;&#25104;&#30340; jwt&#12290;</P>
<P data-immersive-translate-paragraph="1" data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822">This is where things go really wrong really fast as we get logged out for a momment and before we know it we get logged in as the victim. 
<P>&#22312;&#36825;&#37324;&#65292;&#20107;&#24773;&#20250;&#38750;&#24120;&#36805;&#36895;&#22320;&#20986;&#38169;&#65292;&#25105;&#20204;&#34987;&#30331;&#20986;&#20102;&#19968;&#20250;&#20799;&#65292;&#27809;&#36807;&#22810;&#20037;&#23601;&#20197;&#21463;&#23475;&#32773;&#30340;&#36523;&#20221;&#30331;&#24405;&#20102;&#12290;</P>
<P data-immersive-translate-paragraph="1" data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822">This is due to a misconfigured OIDC [i believe] it takes in a few params including a JWT TOKEN Created by the oauth2 follow. 
<P>&#36825;&#26159;&#30001;&#20110;&#37197;&#32622;&#38169;&#35823;&#30340; OIDC [&#25105;&#30456;&#20449;]&#65292;&#23427;&#25509;&#21463;&#19968;&#20123;&#21442;&#25968;&#65292;&#21253;&#25324;&#30001; oauth2 &#21019;&#24314;&#30340; JWT TOKEN&#12290;</P>
<H2 data-immersive-translate-paragraph="1" data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822">Reproduction Steps&nbsp;&nbsp;&#37325;&#29616;&#27493;&#39588;</H2>
<P data-immersive-translate-paragraph="1" data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822">The attack goes as follows; 
<P>&#25915;&#20987;&#36807;&#31243;&#22914;&#19979;&#65307;</P>
<P data-immersive-translate-paragraph="1" data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822">So basically the takeover works as flows, User is registered at<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">https://tennis-app.xboy.me</FONT></CODE><SPAN>&nbsp;</SPAN>only and not<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">https://court-app.xboy.me/</FONT></CODE><SPAN>&nbsp;</SPAN>=&gt; We (attacker) register at<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">https://court-app.xboy.me/</FONT></CODE><SPAN>&nbsp;</SPAN>=&gt; after successfull registration (no email verification) we go to<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">https://tennis-app.xboy.me</FONT></CODE><SPAN>&nbsp;</SPAN>and select the Oauth2 (OIDC) login option and we get logged into the victim account after a moment 
<P>&#25152;&#20197;&#22522;&#26412;&#19978;&#25509;&#31649;&#30340;&#27969;&#31243;&#26159;&#36825;&#26679;&#30340;&#65292;&#29992;&#25143;&#20165;&#22312;<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">https://tennis-app.xboy.me</FONT></CODE><SPAN>&nbsp;</SPAN>&#27880;&#20876;&#65292;&#32780;&#19981;&#26159;<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">https://court-app.xboy.me/</FONT></CODE><SPAN>&nbsp;</SPAN>=&gt; &#25105;&#20204;&#65288;&#25915;&#20987;&#32773;&#65289;&#22312;<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">https://court-app.xboy.me/</FONT></CODE><SPAN>&nbsp;</SPAN>&#27880;&#20876; =&gt; &#25104;&#21151;&#27880;&#20876;&#21518;&#65288;&#26080;&#38656;&#30005;&#23376;&#37038;&#20214;&#39564;&#35777;&#65289;&#65292;&#25105;&#20204;&#21069;&#24448;<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">https://tennis-app.xboy.me</FONT></CODE><SPAN>&nbsp;</SPAN>&#24182;&#36873;&#25321; Oauth2 (OIDC) &#30331;&#24405;&#36873;&#39033;&#65292;&#31245;&#21518;&#25105;&#20204;&#23601;&#20250;&#30331;&#24405;&#21040;&#21463;&#23475;&#32773;&#36134;&#25143;</P>
<BLOCKQUOTE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822">
<P data-immersive-translate-paragraph="1" data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822">i.e user registers at<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">https://tennis-app.xboy.me</FONT></CODE><SPAN>&nbsp;</SPAN>with "<A data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822">root@xboy.me</A>" and password "#sup3rs3cur3P4ss$", confirms account and starts to use it, as attackers we just head to<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">https://court-app.xboy.me/</FONT></CODE><SPAN>&nbsp;</SPAN>and register an account with "<A data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822">root@xboy.me</A>" and password "#@Password-1234" but we don&#39;t need to confirm the email. we then head to<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">https://tennis-app.xboy.me</FONT></CODE><SPAN>&nbsp;</SPAN>and select the Oauth2 (OIDC) login option and we get wait for the accounts to be merged</P></BLOCKQUOTE>
<P data-immersive-translate-paragraph="1" data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822">Reproduction is as simple as; 
<P>&#22797;&#21046;&#26159;&#22914;&#27492;&#31616;&#21333;&#65307;</P>
<OL data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822">
<LI data-immersive-translate-paragraph="1" data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822">Go to<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">https://tennis-app.xboy.me</FONT></CODE><SPAN>&nbsp;</SPAN>and create an account with an email not registered at<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">https://court-app.xboy.me</FONT></CODE> 
<P>&#21069;&#24448;<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">https://tennis-app.xboy.me</FONT></CODE><SPAN>&nbsp;</SPAN>&#24182;&#20351;&#29992;&#26410;&#22312;<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">https://court-app.xboy.me</FONT></CODE><SPAN>&nbsp;</SPAN>&#27880;&#20876;&#30340;&#30005;&#23376;&#37038;&#20214;&#21019;&#24314;&#19968;&#20010;&#24080;&#25143;</P>
<LI data-immersive-translate-paragraph="1" data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822">Log out on completion 
<P>&#23436;&#25104;&#21518;&#27880;&#38144;</P>
<LI data-immersive-translate-paragraph="1" data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822">Go to<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">https://court-app.xboy.me</FONT></CODE><SPAN>&nbsp;</SPAN>and create an account with the above email and finish the set up [wont ask for verification] 
<P>&#21069;&#24448;<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">https://court-app.xboy.me</FONT></CODE><SPAN>&nbsp;</SPAN>&#24182;&#20351;&#29992;&#19978;&#36848;&#30005;&#23376;&#37038;&#20214;&#21019;&#24314;&#19968;&#20010;&#24080;&#25143;&#65292;&#23436;&#25104;&#35774;&#32622; [&#19981;&#20250;&#35201;&#27714;&#39564;&#35777;]</P>
<LI data-immersive-translate-paragraph="1" data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822">Head back to<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">https://tennis-app.xboy.me</FONT></CODE><SPAN>&nbsp;</SPAN>and click login with<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">court-app</FONT></CODE><SPAN>&nbsp;</SPAN>observe the flow and at the end you have you account takeover 
<P>&#36820;&#22238;&#21040;<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">https://tennis-app.xboy.me</FONT></CODE><SPAN>&nbsp;</SPAN>&#65292;&#28857;&#20987;&#20351;&#29992;<SPAN>&nbsp;</SPAN><CODE data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><FONT face="Courier New">court-app</FONT></CODE><SPAN>&nbsp;</SPAN>&#30331;&#24405;&#65292;&#35266;&#23519;&#27969;&#31243;&#65292;&#26368;&#21518;&#20320;&#23558;&#33719;&#24471;&#36134;&#25143;&#25509;&#31649;</P></LI></OL>
<H2 data-immersive-translate-paragraph="1" data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822">Report&nbsp;&nbsp;&#25253;&#21578;</H2>
<P data-immersive-translate-paragraph="1" data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822">I quickly made a detailed report with as much explanation as i could and submitted. report got triaged in less than two hours as a critical and got awarded &#8364;&#8364;&#8364;&#8364; bounty. 
<P>&#25105;&#36805;&#36895;&#21046;&#20316;&#20102;&#19968;&#20221;&#35814;&#32454;&#25253;&#21578;&#65292;&#23613;&#21487;&#33021;&#22810;&#22320;&#36827;&#34892;&#20102;&#35299;&#37322;&#24182;&#25552;&#20132;&#12290;&#25253;&#21578;&#22312;&#19981;&#21040;&#20004;&#23567;&#26102;&#20869;&#34987;&#35780;&#20272;&#20026;&#20851;&#38190;&#65292;&#24182;&#33719;&#24471;&#20102;&#8364;&#8364;&#8364;&#8364;&#30340;&#22870;&#37329;&#12290;</P>
<P data-immersive-translate-walked="9b782006-1a2f-4687-bd99-a4bd1bfd4822"><img alt=basic src="https://blog.xboy.me/images/poc/takeover.png" data-cubox-image-load="false" data-cubox-image-index="0" data-cubox-image-id="b1471897a632ea95fd50af45a806f3f5">